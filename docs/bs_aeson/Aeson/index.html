<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Aeson (bs_aeson.Aeson)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../">Up</a> â€“ <a href="../">bs_aeson</a> &#x00BB; Aeson</nav><h1>Module <code>Aeson</code></h1><p>Efficient JSON handling This module has four aspects to it:</p><ul><li>Parsing, which turns a JSON string into an encoded JSON data structure</li><li>Stringificaiton, which produces a JSON string from an encoded JSON data structure</li><li>Encoding, which is the process of construction a JSON data strcture</li><li>Decoding, which is the process of deconstructing a JSON data structure</li></ul><h4 id="parsing"><a href="#parsing" class="anchor"></a>Parsing</h4><p><code>parse</code> and <code>exnParse</code> will both (try to) parse a JSON string into a JSON data structure (<span class="xref-unresolved" title="unresolved reference to &quot;Js.Json.t&quot;"><span class="xref-unresolved" title="unresolved reference to &quot;Js.Json&quot;"><code>Js</code>.Json</span>.t</span>), but behhaves differently when encountering a parse error. <code>exnParse</code> will raise a <code>SyntaxError</code>, while <code>parse</code> will return a <code>Js.Json.t result</code> indicating whether or not the parsing succeeded. There's not much more to it: <code>string</code> in, <code>Js.Json.t</code> out. The parsed result, and encoded JSON data structure, then needs to be decoded to avtually be usable. See <code>Decoding</code> below.</p><h4 id="stringification"><a href="#stringification" class="anchor"></a>Stringification</h4><p>Stringificaiton is the exact reverse of parsing. <code>stringify</code> and <code>stringifyAny</code> both technically do the same thing, but where <code>stringifyAny</code> will take any value and try to do its best with it, retuning a <code>string option</code>, <code>stringify</code> on the other handuses the type system to guarantee success, but requires that the data has been encoded in a JSON data structure first. See <code>Encoding</code> below.</p><h4 id="encoding"><a href="#encoding" class="anchor"></a>Encoding</h4><p>Encoding creates a JSON data structure which can stringified directly with <code>stringify</code> or passed to other APIs requiring a typed JSON data structure. Or you could just go straight to decoding it again, if that's your thing. ENcoding functions are in the <a href="Encode"><code>Encode</code></a> module.</p><h4 id="decoding"><a href="#decoding" class="anchor"></a>Decoding</h4><p>Decoding is a more complex process, due to the highly dynamic nature of JSON data structures. There are several ways to decode a JSON data structure, depending on your needs. This module provides two fairly low level methods of decoding, the assertive, more convenient but also more rigid <a href="Decode"><code>Decode</code></a> module and the more flexible but cumbersome <code>reifyType</code> and <code>test</code> functions. The third way is to use a opinionated third-party APIs that makes other tradeoffs. @example </p><pre><code class="ml">(* Parsing a JSON string using Js.Json.parse *)
open Js.Json
let arrayOfInts str
  match parse str with
  | Ok value -&gt;
    match Decode.(array int value)
    | Ok arr -&gt; arr
    | Error _ -&gt; []
  | Error message -&gt; failWith message
(* prints `[3, 2, 1]` *)
let _ = Js.log \@\@ arrayOfInts &quot;[1, 2, 3]&quot; |&gt; Js.Array.reverse</code></pre><p>@example </p><pre><code class="ml">(* Stringifying a value using Js.Json.stringifyAny *)
open Js.Json
(* prints `null` *)
let _ =
  match stringifyAny Js.null with
  | Some str -&gt; Js.log str
  | None -&gt; Js.log &quot;Unable to stringify value&quot;</code></pre><p>@example </p><pre><code class="ml">(* Encoding a JSON data structure using Js.Json.Encode *)
open Js.Json
(* prints [&quot;foo&quot;, &quot;bar&quot;] *)
let _ =
  [| &quot;foo&quot;, &quot;bar&quot; |]
  |&gt; Encode.stringArray
  |&gt; stringify
  |&gt; Js.log
(* prints [&quot;foo&quot;, &quot;bar&quot;] *)
let _ =
  [| &quot;foo&quot;, &quot;bar&quot; |]
  |&gt; Js.Array.map Encode.int
  |&gt; Encode.array
  |&gt; stringify
  |&gt; Js.log</code></pre><p>@example </p><pre><code class="ml">(* Decoding a fixed JSON data structure using Js.Json.Decode *)
open Js.Json
let mapJsonObjectString f decoder encoder str =
  match parse str with
  | Ok json -&gt;
    match Decode.(dict decoder json) with
    | Ok dict -&gt;
      dict |&gt; Js.Dict.map f
           |&gt; Js.Dict.map encoder
           |&gt; Encode.dict
           |&gt; Js.stringify
    | Error _ -&gt; []
  | Error _ -&gt; []
let sum ns =
  Array.fold_left (+) 0
(* prints `{ &quot;foo&quot;: 6, &quot;bar&quot;: 24 }` *)
let _ =
  Js.log \@\@
    mapJsonObjectString sun Decode.(array int) Encode.int {|
      {
        &quot;foo&quot;: [1, 2, 3],
        &quot;bar&quot;: [9, 8, 7]
      }
    |} </code></pre><p>@example </p><pre><code class="ml">(* Decoding a highly dynamic JSON data structure using reifyType *)
open Js.Json
let getIds s =
  let json = 
    try parse s with
    | _ -&gt; failwith &quot;Error parsing JSON string&quot;
  in 
  match reifyType json with
  | (Object, value) -&gt;
    (* In this branch, compiler infer value : t Js.Dict.t *)
    begin match Js.Dict.get value &quot;ids&quot; with
    | Some ids -&gt; 
      begin match reifyType ids with
      | (Array, ids) -&gt; 
        (* In this branch compiler infer ids : t array *)
        ids
      | _ -&gt; failWith &quot;Expected an array&quot;
      end 
    | None -&gt; failWith &quot;Expected an `ids` property&quot;
    end 
  | _ -&gt; failWith &quot;Expected an object&quot;
(* prints `1, 2, 3` *)
let _ =
  Js.log \@\@ getIds {| { &quot;ids&quot; : [1, 2, 3 ] } |} </code></pre><dl><dt>see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON</a></dt><dd><p>MDN</p></dd></dl></header><div class="spec module" id="module-Decode"><a href="#module-Decode" class="anchor"></a><code><span class="keyword">module</span> Decode = Aeson_decode;</code></div><div class="spec module" id="module-Encode"><a href="#module-Encode" class="anchor"></a><code><span class="keyword">module</span> Encode = Aeson_encode;</code></div><div class="spec module" id="module-Compatibility"><a href="#module-Compatibility" class="anchor"></a><code><span class="keyword">module</span> Compatibility = Aeson_compatibility;</code></div></div></body></html>