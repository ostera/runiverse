steps:
  - template: utils/use-node.yml

  - task: DownloadPipelineArtifact@0
    displayName: "Download package-index-json"
    inputs:
      artifactName: package-index-json
      targetPath: $(Build.StagingDirectory)

  - script: yarn install
    workingDirectory: web
    displayName: Install dependencies

  - script: yarn clean
    workingDirectory: web
    displayName: Clean world

  - script: yarn build
    workingDirectory: web
    displayName: Build world

  - task: CopyFiles@2
    inputs:
      SourceFolder: '$(System.DefaultWorkingDirectory)'
      Contents: |
        web/index.html
        web/_bundle/*
      TargetFolder: '$(Build.ArtifactStagingDirectory)'

  - task: PublishBuildArtifacts@1
    displayName: "Publish Artifact: website"
    inputs:
      PathtoPublish: "$(Build.ArtifactStagingDirectory)"
      ArtifactName: website